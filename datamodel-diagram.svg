<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 620" width="1200" height="620" font-family="'Segoe UI', Arial, sans-serif">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f0f1a"/>
      <stop offset="100%" style="stop-color:#1a1a2e"/>
    </linearGradient>
    <linearGradient id="primaryGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1e1e3a"/>
      <stop offset="100%" style="stop-color:#16162e"/>
    </linearGradient>
    <linearGradient id="wfaGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0e2035"/>
      <stop offset="100%" style="stop-color:#0a1828"/>
    </linearGradient>
    <linearGradient id="wfbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0e2818"/>
      <stop offset="100%" style="stop-color:#0a1e12"/>
    </linearGradient>
    <linearGradient id="convergeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1e1030"/>
      <stop offset="100%" style="stop-color:#160a24"/>
    </linearGradient>
    <marker id="arr-down" markerWidth="8" markerHeight="8" refX="4" refY="7" orient="auto">
      <path d="M1,1 L4,7 L7,1" fill="none" stroke="#555577" stroke-width="1.5"/>
    </marker>
    <marker id="arr-wfa" markerWidth="8" markerHeight="8" refX="4" refY="7" orient="auto">
      <path d="M1,1 L4,7 L7,1" fill="none" stroke="#1d6fa4" stroke-width="1.5" opacity="0.7"/>
    </marker>
    <marker id="arr-wfb" markerWidth="8" markerHeight="8" refX="4" refY="7" orient="auto">
      <path d="M1,1 L4,7 L7,1" fill="none" stroke="#2d7a5e" stroke-width="1.5" opacity="0.7"/>
    </marker>
    <marker id="arr-converge-l" markerWidth="8" markerHeight="8" refX="4" refY="7" orient="auto">
      <path d="M1,1 L4,7 L7,1" fill="none" stroke="#7B5EA7" stroke-width="1.5" opacity="0.8"/>
    </marker>
    <marker id="arr-converge-r" markerWidth="8" markerHeight="8" refX="4" refY="7" orient="auto">
      <path d="M1,1 L4,7 L7,1" fill="none" stroke="#7B5EA7" stroke-width="1.5" opacity="0.8"/>
    </marker>
    <filter id="shadow">
      <feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="#000000" flood-opacity="0.5"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1200" height="620" fill="url(#bg)" rx="12"/>

  <!-- Title -->
  <text x="600" y="34" text-anchor="middle" fill="#ffffff" font-size="14" font-weight="400" letter-spacing="3" opacity="0.45">DATA MODEL</text>
  <text x="600" y="62" text-anchor="middle" fill="#ffffff" font-size="21" font-weight="700" letter-spacing="0.3">Entity Hierarchy &amp; Dual-Workflow Structure</text>

  <!-- Legend -->
  <rect x="380" y="76" width="14" height="14" rx="3" fill="#1e1e3a" stroke="#555577" stroke-width="1.2"/>
  <text x="400" y="87" fill="#888899" font-size="11">Primary hierarchy</text>
  <rect x="520" y="76" width="14" height="14" rx="3" fill="#0e2035" stroke="#1d6fa4" stroke-width="1.2"/>
  <text x="540" y="87" fill="#88ccff" font-size="11">Workflow A</text>
  <rect x="640" y="76" width="14" height="14" rx="3" fill="#0e2818" stroke="#2d7a5e" stroke-width="1.2"/>
  <text x="660" y="87" fill="#aaffcc" font-size="11">Workflow B</text>
  <rect x="760" y="76" width="14" height="14" rx="3" fill="#1e1030" stroke="#7B5EA7" stroke-width="1.2"/>
  <text x="780" y="87" fill="#ddaaff" font-size="11">Convergence</text>

  <!-- ════════════════════════════
       ROW 1 — Investor (top, center)
  ════════════════════════════ -->
  <rect x="460" y="104" width="280" height="68" rx="8" fill="url(#primaryGrad)" stroke="#555577" stroke-width="1.4" filter="url(#shadow)"/>
  <text x="600" y="126" text-anchor="middle" fill="#ccccdd" font-size="13" font-weight="700">Investor</text>
  <line x1="476" y1="134" x2="724" y2="134" stroke="#ffffff" stroke-width="0.4" opacity="0.1"/>
  <text x="600" y="150" text-anchor="middle" fill="#777788" font-size="10">tax_filing_status · marginal_rate · ltcg_rate · ytd_realized_gain</text>
  <text x="600" y="163" text-anchor="middle" fill="#666677" font-size="10">stcg_rate · ytd_realized_loss · preferred_accounting_method</text>

  <!-- Investor → Account arrow -->
  <line x1="600" y1="172" x2="600" y2="192" stroke="#555577" stroke-width="1.5" marker-end="url(#arr-down)"/>
  <text x="614" y="185" fill="#444455" font-size="9" letter-spacing="1">1:N</text>

  <!-- ════════════════════════════
       ROW 2 — Account
  ════════════════════════════ -->
  <rect x="460" y="196" width="280" height="68" rx="8" fill="url(#primaryGrad)" stroke="#555577" stroke-width="1.4" filter="url(#shadow)"/>
  <text x="600" y="218" text-anchor="middle" fill="#ccccdd" font-size="13" font-weight="700">Account</text>
  <line x1="476" y1="226" x2="724" y2="226" stroke="#ffffff" stroke-width="0.4" opacity="0.1"/>
  <text x="600" y="242" text-anchor="middle" fill="#777788" font-size="10">account_type · account_number · is_taxable · display_name</text>
  <text x="600" y="255" text-anchor="middle" fill="#ff9999" font-size="10" font-weight="600">⚠ Scoped to taxable brokerage — IRA/401k excluded v1</text>

  <!-- Account → FundHolding arrow -->
  <line x1="600" y1="264" x2="600" y2="284" stroke="#555577" stroke-width="1.5" marker-end="url(#arr-down)"/>
  <text x="614" y="277" fill="#444455" font-size="9" letter-spacing="1">1:N</text>

  <!-- ════════════════════════════
       ROW 3 — FundHolding (BRANCH POINT)
  ════════════════════════════ -->
  <rect x="460" y="288" width="280" height="78" rx="8" fill="url(#primaryGrad)" stroke="#555577" stroke-width="1.4" filter="url(#shadow)"/>
  <!-- Branch indicator -->
  <rect x="460" y="288" width="6" height="78" rx="4" fill="#555577" opacity="0.4"/>
  <text x="608" y="312" text-anchor="middle" fill="#ccccdd" font-size="13" font-weight="700">FundHolding</text>
  <line x1="476" y1="320" x2="724" y2="320" stroke="#ffffff" stroke-width="0.4" opacity="0.1"/>
  <text x="608" y="336" text-anchor="middle" fill="#777788" font-size="10">fund_symbol · total_shares · current_nav · total_market_value</text>
  <text x="608" y="349" text-anchor="middle" fill="#777788" font-size="10">unrealized_stcg · unrealized_ltcg · allocation_pct · target_pct</text>
  <text x="608" y="362" text-anchor="middle" fill="#ffdd88" font-size="9" opacity="0.8">← workflow branches split here</text>

  <!-- FundHolding → TaxLot arrow (center) -->
  <line x1="600" y1="366" x2="600" y2="386" stroke="#555577" stroke-width="1.5" marker-end="url(#arr-down)"/>

  <!-- FundHolding → SellRequest branch left -->
  <path d="M 476 327 Q 300 327 300 386" fill="none" stroke="#1d6fa4" stroke-width="1.5" stroke-dasharray="4,3" opacity="0.6" marker-end="url(#arr-wfa)"/>

  <!-- FundHolding → ManualSellScenario branch right -->
  <path d="M 724 327 Q 900 327 900 386" fill="none" stroke="#2d7a5e" stroke-width="1.5" stroke-dasharray="4,3" opacity="0.6" marker-end="url(#arr-wfb)"/>

  <!-- ════════════════════════════
       ROW 4 — Three columns: WfA left | TaxLot center | WfB right
  ════════════════════════════ -->

  <!-- WFA LEFT: SellRequest / SellRecommendation -->
  <rect x="60" y="390" width="280" height="120" rx="8" fill="url(#wfaGrad)" stroke="#1d6fa4" stroke-width="1.4" filter="url(#shadow)"/>
  <rect x="60" y="390" width="280" height="24" rx="8" fill="#1d6fa4" opacity="0.2"/>
  <text x="88" y="400" fill="#88ccff" font-size="9" font-weight="700" letter-spacing="1.5">WORKFLOW A</text>
  <text x="200" y="420" text-anchor="middle" fill="#88ccff" font-size="12" font-weight="700">SellRequest</text>
  <text x="200" y="435" text-anchor="middle" fill="#6699bb" font-size="10">total_amount · accounting_method</text>
  <text x="200" y="449" text-anchor="middle" fill="#6699bb" font-size="10">optimization_status · created_at</text>
  <line x1="76" y1="457" x2="324" y2="457" stroke="#1d6fa4" stroke-width="0.5" opacity="0.3" stroke-dasharray="2,3"/>
  <text x="200" y="472" text-anchor="middle" fill="#88ccff" font-size="12" font-weight="700">SellRecommendation</text>
  <text x="200" y="487" text-anchor="middle" fill="#6699bb" font-size="10">recommended_fund_sales · projected_tax</text>
  <text x="200" y="500" text-anchor="middle" fill="#6699bb" font-size="10">lot_selections · rebalancing_impact</text>

  <!-- CENTER: TaxLot -->
  <rect x="460" y="390" width="280" height="76" rx="8" fill="url(#primaryGrad)" stroke="#555577" stroke-width="1.4" filter="url(#shadow)"/>
  <text x="600" y="412" text-anchor="middle" fill="#ccccdd" font-size="13" font-weight="700">TaxLot</text>
  <line x1="476" y1="420" x2="724" y2="420" stroke="#ffffff" stroke-width="0.4" opacity="0.1"/>
  <text x="600" y="436" text-anchor="middle" fill="#777788" font-size="10">purchase_date · cost_basis · shares · current_value</text>
  <text x="600" y="449" text-anchor="middle" fill="#777788" font-size="10">unrealized_gain_loss · holding_period · lot_character</text>
  <text x="600" y="462" text-anchor="middle" fill="#ffdd88" font-size="9" opacity="0.7">ST/LT mutually exclusive per lot — not per holding</text>

  <!-- TaxLot → TaxLotDisposition -->
  <line x1="600" y1="466" x2="600" y2="486" stroke="#555577" stroke-width="1.5" marker-end="url(#arr-down)"/>
  <text x="614" y="479" fill="#444455" font-size="9" letter-spacing="1">1:N</text>

  <!-- TaxLotDisposition -->
  <rect x="460" y="490" width="280" height="56" rx="8" fill="url(#primaryGrad)" stroke="#555577" stroke-width="1.4" filter="url(#shadow)"/>
  <text x="600" y="512" text-anchor="middle" fill="#ccccdd" font-size="13" font-weight="700">TaxLotDisposition</text>
  <line x1="476" y1="520" x2="724" y2="520" stroke="#ffffff" stroke-width="0.4" opacity="0.1"/>
  <text x="600" y="536" text-anchor="middle" fill="#777788" font-size="10">shares_sold · proceeds · realized_gain_loss · tax_character</text>

  <!-- WFB RIGHT: ManualSellScenario / ManualFundSale -->
  <rect x="860" y="390" width="280" height="120" rx="8" fill="url(#wfbGrad)" stroke="#2d7a5e" stroke-width="1.4" filter="url(#shadow)"/>
  <rect x="860" y="390" width="280" height="24" rx="8" fill="#2d7a5e" opacity="0.2"/>
  <text x="888" y="400" fill="#aaffcc" font-size="9" font-weight="700" letter-spacing="1.5">WORKFLOW B</text>
  <text x="1000" y="420" text-anchor="middle" fill="#aaffcc" font-size="12" font-weight="700">ManualSellScenario</text>
  <text x="1000" y="435" text-anchor="middle" fill="#66aa88" font-size="10">scenario_name · accounting_method</text>
  <text x="1000" y="449" text-anchor="middle" fill="#ff9999" font-size="9">source_recommendation_id → null if Wf-B</text>
  <line x1="876" y1="457" x2="1124" y2="457" stroke="#2d7a5e" stroke-width="0.5" opacity="0.3" stroke-dasharray="2,3"/>
  <text x="1000" y="472" text-anchor="middle" fill="#aaffcc" font-size="12" font-weight="700">ManualFundSale</text>
  <text x="1000" y="487" text-anchor="middle" fill="#66aa88" font-size="10">user_entered_amount · estimated_stcg/ltcg</text>
  <text x="1000" y="500" text-anchor="middle" fill="#66aa88" font-size="10">estimated_total_tax · allocation_after_sale</text>

  <!-- ════════════════════════════
       ROW 5 — ScenarioTaxImpact (convergence)
  ════════════════════════════ -->

  <!-- WfA → ScenarioTaxImpact arrow -->
  <path d="M 200 510 Q 200 560 460 568" fill="none" stroke="#7B5EA7" stroke-width="1.5" opacity="0.6" marker-end="url(#arr-converge-l)"/>

  <!-- WfB → ScenarioTaxImpact arrow -->
  <path d="M 1000 510 Q 1000 560 740 568" fill="none" stroke="#7B5EA7" stroke-width="1.5" opacity="0.6" marker-end="url(#arr-converge-r)"/>

  <!-- TaxLotDisposition → ScenarioTaxImpact -->
  <line x1="600" y1="546" x2="600" y2="558" stroke="#7B5EA7" stroke-width="1.5" opacity="0.6" marker-end="url(#arr-converge-l)"/>

  <!-- ScenarioTaxImpact -->
  <rect x="310" y="558" width="580" height="54" rx="8" fill="url(#convergeGrad)" stroke="#7B5EA7" stroke-width="1.6" filter="url(#shadow)"/>
  <text x="600" y="576" text-anchor="middle" fill="#ddaaff" font-size="13" font-weight="700">ScenarioTaxImpact</text>
  <text x="600" y="591" text-anchor="middle" fill="#aa88cc" font-size="10">net_stcg · net_ltcg · losses_harvested · net_taxable_gain · est_federal_tax · est_state_tax</text>
  <text x="600" y="604" text-anchor="middle" fill="#aa88cc" font-size="10">est_total_tax · rebalancing_drift · <tspan font-weight="700" fill="#ddaaff">effective_tax_rate_on_sale</tspan></text>

  <!-- Convergence label -->
  <text x="910" y="578" fill="#7B5EA7" font-size="10" opacity="0.7" letter-spacing="1">← BOTH WORKFLOWS CONVERGE</text>
  <text x="910" y="592" fill="#7B5EA7" font-size="10" opacity="0.7" letter-spacing="1">   RECALCULATES ON EVERY CHANGE</text>

  <!-- Footer -->
  <text x="600" y="618" text-anchor="middle" fill="#1e1e33" font-size="10">Vanguard Sell &amp; Rebalance Tool · Data Model · Michael Casey · 2026</text>
</svg>
